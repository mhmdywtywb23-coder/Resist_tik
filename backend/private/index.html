<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>لوحة الأدمن</title>
</head>
<body style="background:#0f1c2c; color:#e6eef8; font-family:sans-serif; padding:20px;">

<h2>لوحة الأدمن</h2>

<div style="margin:20px 0; padding:12px; background:#071124; border-radius:8px;">
  <h3 style="margin:0 0 8px; color:#9be6d0">إنشاء كود جديد للزبون</h3>
  <label style="font-size:14px; color:#bcd8cf">مدة الكود بالأيام:</label>
  <input id="codeDays" type="number" min="1" value="1" style="width:80px; padding:6px; margin-left:8px;">
  <button id="createCodeBtn" style="padding:8px 12px; margin-left:8px; background:#00e6b8; border:none; border-radius:6px; cursor:pointer;">إنشاء كود</button>

  <div id="newCodeBox" style="margin-top:12px; display:none; padding:10px; background:#071824; border-radius:6px; color:#e6eef8;">
    <div>الكود: <strong id="newCode" style="font-size:18px; color:#00ffb3"></strong></div>
    <div>ينتهي في: <span id="newCodeExpires" style="color:#bcd8cf"></span></div>
    <div style="margin-top:8px;"><small>انسخ الكود وارسله للزبون. الكود صالح فقط حتى التاريخ أعلاه.</small></div>
  </div>
</div>

<script>
document.getElementById('createCodeBtn').addEventListener('click', async ()=>{
  const days = Number(document.getElementById('codeDays').value) || 1;
  try{
    const res = await fetch('/admin/create-code',{
      method:'POST',
      headers:{'Content-Type':'application/x-www-form-urlencoded'},
      body:`days=${encodeURIComponent(days)}`
    });
    if(!res.ok){ alert('خطأ في إنشاء الكود'); return; }
    const data = await res.json();
    document.getElementById('newCode').textContent = data.code;
    const d = new Date(Number(data.expires));
    document.getElementById('newCodeExpires').textContent = d.toLocaleString();
    document.getElementById('newCodeBox').style.display = 'block';
  } catch(e){
    alert('خطأ بالشبكة');
  }
});
</script>

</body>
</html>
