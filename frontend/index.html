<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Resist_Tik_Pro — Compressor</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0b0b0c;--panel:#0f1720;--muted:#94a3b8;--accent:#14b8a6;--card:#0f1724;--glass: rgba(255,255,255,0.03);}
*{box-sizing:border-box}
body{margin:0;font-family:Inter, system-ui,-apple-system,'Segoe UI',Roboto,'Noto Sans Arabic',sans-serif;background:var(--bg);color:#e6eef2;direction:rtl}
.container{max-width:980px;margin:32px auto;padding:22px}
.header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
.logo{background:linear-gradient(135deg,var(--accent),#06b6d4);width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#011;font-size:18px}
.title-wrap h1{margin:0;font-size:20px;color:var(--accent)}
.title-wrap p{margin:0;color:var(--muted);font-size:14px}
.card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
.drop{border:2px dashed rgba(255,255,255,0.06);border-radius:10px;padding:18px;text-align:center;background:var(--glass);cursor:pointer}
.btn{background:var(--accent);border:none;padding:10px 14px;border-radius:10px;color:#001;font-weight:600;cursor:pointer}
.ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04);padding:9px 12px;border-radius:9px;cursor:pointer}
.controls{display:flex;gap:8px;align-items:center;margin-top:10px}
.right{margin-right:auto}
.progress{height:10px;background:rgba(255,255,255,0.06);border-radius:999px;overflow:hidden;margin-top:12px}
.progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),#06b6d4)}
.small{font-size:13px;color:var(--muted)}
.footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">RTP</div>
    <div class="title-wrap">
      <h1>Resist_Tik_Pro</h1>
      <p>@Ds1_RESIST</p>
    </div>
  </div>

  <div class="card">
    <div id="drop" class="drop" tabindex="0">
      <div style="font-weight:600">اضغط لإضافة ملف فيديو أو اسحبه هنا</div>
      <div class="small" style="margin-top:8px">MP4 — 1080p — 60fps</div>
      <input id="file" type="file" accept="video/*" style="display:none" />
    </div>

    <div class="controls">
      <button id="start" class="btn">ابدأ الضغط</button>
      <a id="download" class="ghost" style="display:none">تحميل</a>
      <button id="adminBtn" class="ghost" style="display:none">لوحة الادمن</button>
      <div class="right small" id="status">لم يتم اختيار ملف</div>
    </div>

    <div class="progress" aria-hidden="true"><i id="bar"></i></div>
  </div>

  <div class="footer">Resist_Tik_Pro — يعمل عبر الخادم لمعالجة الفيديو</div>
</div>

<!-- Admin modal (hidden, front-only control) -->
<div id="adminModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;padding:18px">
  <div style="max-width:520px;margin:auto;background:#081018;padding:18px;border-radius:12px;color:#dfeff3">
    <h3 style="margin:0 0 8px;color:var(--accent)">لوحة الادمن</h3>
    <div style="font-size:13px;color:var(--muted);margin-bottom:10px">ادخل كلمة سر الادمن لتوليد الكود</div>
    <input id="adminPwd" placeholder="كلمة سر الادمن" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);margin-bottom:10px;background:transparent;color:#fff" />
    <div style="display:flex;gap:8px">
      <input id="days" type="number" value="7" style="width:120px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff" />
      <button id="gen" class="btn">انشئ كود</button>
      <button id="export" class="ghost">تصدير الأكواد</button>
    </div>
    <pre id="codes" style="height:120px;background:#071017;border-radius:8px;padding:8px;margin-top:10px;overflow:auto;color:var(--muted)"></pre>
    <div style="text-align:right;margin-top:10px"><button id="closeAdmin" class="ghost">اغلاق</button></div>
  </div>
</div>

<script>
// Frontend connects to backend /compress and downloads response blob
const API_BASE = ''; // same origin
const fileInput = document.getElementById('file');
const drop = document.getElementById('drop');
const startBtn = document.getElementById('start');
const download = document.getElementById('download');
const status = document.getElementById('status');
const bar = document.getElementById('bar');
let currentFile = null;

drop.addEventListener('click', ()=> fileInput.click());
drop.addEventListener('dragover', (e)=>{ e.preventDefault(); drop.style.borderColor='rgba(255,255,255,0.16)'; });
drop.addEventListener('dragleave', ()=>{ drop.style.borderColor='rgba(255,255,255,0.06)'; });
drop.addEventListener('drop', (e)=>{ e.preventDefault(); const f = e.dataTransfer.files[0]; if(f) handleFile(f); });

fileInput.addEventListener('change', ()=>{ const f = fileInput.files[0]; if(f) handleFile(f); });

function handleFile(f){
  currentFile = f;
  status.textContent = `ملف جاهز: ${f.name}`;
  download.style.display='none';
  bar.style.width='0%';
}

startBtn.addEventListener('click', ()=>{
  if(!currentFile) return alert('حط ملف أول');
  uploadAndCompress(currentFile);
});

function uploadAndCompress(file){
  status.textContent = 'جاري رفع الملف...';
  const xhr = new XMLHttpRequest();
  xhr.open('POST', API_BASE + '/compress');
  xhr.responseType = 'blob';

  xhr.upload.addEventListener('progress', (e)=>{
    if(e.lengthComputable){
      const p = Math.round(e.loaded / e.total * 100);
      bar.style.width = p + '%';
      status.textContent = 'رفع: ' + p + '%';
    }
  });

  xhr.onload = ()=>{
    if(xhr.status === 200){
      const filename = xhr.getResponseHeader('X-File-Name') || 'resist_tik_compressed.mp4';
      const blob = xhr.response;
      const url = URL.createObjectURL(blob);
      download.href = url;
      download.download = filename;
      download.style.display = 'inline-block';
      status.textContent = 'انتهى التحويل — حمّل الملف';
      bar.style.width = '100%';
    } else {
      status.textContent = 'فشل المعالجة';
      alert('خطأ في الخادم: ' + xhr.status);
      bar.style.width = '0%';
    }
  };

  const fd = new FormData();
  fd.append('file', file);
  xhr.send(fd);
  status.textContent = 'جاري رفع الملف...';
}
</script>
</body>
</html>
