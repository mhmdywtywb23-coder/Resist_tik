<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>RESIST_TIK_PRO</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0f0f0f; color: white; text-align: center; padding: 30px; }
    h1 { color: #00ffcc; font-size: 40px; margin-bottom: 20px; }
    form { background: #1a1a1a; padding: 20px; border-radius: 12px; display: inline-block; }
    input, button { margin: 10px; padding: 10px; border-radius: 8px; border: none; font-size: 16px; }
    button { background: #00ffcc; color: black; font-weight: bold; cursor: pointer; }
    .progress { width: 100%; background: #333; border-radius: 8px; margin-top: 15px; }
    .progress-bar { width: 0%; height: 20px; background: #00ffcc; border-radius: 8px; text-align: center; color: black; font-weight: bold; }
  </style>
</head>
<body>
  <h1>🚀 RESIST_TIK_PRO 🚀</h1>
  <form id="uploadForm" enctype="multipart/form-data">
    <input type="text" name="code" placeholder="أدخل الكود" required><br>
    <input type="file" name="video" accept="video/*" required><br>
    <button type="submit">معالجة الفيديو</button>
  </form>

  <div class="progress" style="display:none;">
    <div class="progress-bar" id="progress-bar">0%</div>
  </div>

  <p id="message"></p>

  <script>
    const form = document.getElementById('uploadForm');
    const progress = document.querySelector('.progress');
    const progressBar = document.getElementById('progress-bar');
    const message = document.getElementById('message');

    form.onsubmit = async (e) => {
      e.preventDefault();
      message.textContent = "";
      progress.style.display = "block";
      progressBar.style.width = "0%";
      progressBar.textContent = "0%";

      const formData = new FormData(form);
      const xhr = new XMLHttpRequest();

      xhr.upload.onprogress = (event) => {
        if (event.lengthComputable) {
          let percent = Math.round((event.loaded / event.total) * 100);
          progressBar.style.width = percent + "%";
          progressBar.textContent = percent + "%";
        }
      };

      xhr.onload = () => {
        const res = JSON.parse(xhr.responseText);
        if (res.success) {
          message.innerHTML = res.message + "<br><a href='" + res.download_url + "' style='color:#00ffcc;'>تحميل الفيديو</a>";
        } else {
          message.textContent = res.message;
        }
      };

      xhr.onerror = () => {
        message.textContent = "حدث خطأ أثناء الاتصال بالخادم!";
      };

      xhr.open("POST", "/upload");
      xhr.send(formData);
    };
  </script>
</body>
</html>
